<html>
  <head>
    <script>
    	/*eslint-disable no-new-object */
    	function sendRequest(destinaionUrl, callbackFunction, parameters) {
		  var xmlHttp = new XMLHttpRequest();
		  xmlHttp.onreadystatechange = function() {
		    if (xmlHttp.readyState === 4) {
		      console.log("Response Text:\n" + xmlHttp.responseText);
		      var result = JSON.parse(xmlHttp.responseText);
		      if (result.error) {
		        document.getElementById("errorarea").innerHTML = result.error;
		      }
		      callbackFunction(result);
		    }
	      }

		  var paramString = '';
		  for (var param in parameters) {
		    paramString += param + '=' + escape(parameters[param]) + '&';
		  }
		    
		  xmlHttp.open('POST', destinaionUrl);
		  xmlHttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
		  xmlHttp.send(paramString);
		}
		function getUser() {
		  sendRequest('/user', function(result){
		    if (result.user) {
		      console.log('logged in');
		      sendRequest('/logout', function(result) {
		        var logoutlink = '<a href=' + result.url + '>Click Here to Log Out</a>';
		        document.getElementById('messagearea').innerHTML = logoutlink;
	     	  }, new Object());
		    } else {
		      sendRequest('/login', function(result) {
		        var loginlink = '<a href=' + result.url + '>Click Here to Log In</a>';
		        document.getElementById('messagearea').innerHTML = loginlink;
		      }, new Object());
		    }
		  }, new Object());
		}
		getUser();
	</script>
  </head>
  <body>
    <div id="errorarea" style="color: red; font-weight: bold; text-align: center;"></div>
    <div id="messagearea"></div>
    <form action ="/data" method="post">
      <input type="number" name="mpg" min="10" placeholder="Your Car's MPG"><br>
      <input type='number' name='distance' placeholder='Distance'><br>
	  <input type="radio" name="way" value="walk" checked> walk<br>
	  <input type="radio" name="way" value="bike"> bike<br>
	  <input type="radio" name="way" value="run"> run<br>
	  <textarea type='text' name='comment' placeholder='Add a comment'></textarea><br>
	  <input type="submit" value="Submit">
	</form>
  </body>
</html>